/**
 * RTS Dashboard - Dark Mode Edition
 * Minimal JavaScript for core functionality
 */

(function($) {
    'use strict';

    $(document).ready(function() {
        
        /**
         * Clear Import Progress
         */
        $(document).on('click', '.rts-btn-clear, #rts-clear-import', function(e) {
            e.preventDefault();
            
            if (!confirm('Clear import progress?')) {
                return;
            }
            
            const button = $(this);
            button.prop('disabled', true).text('Clearing...');
            
            $.ajax({
                url: ajaxurl,
                type: 'POST',
                data: {
                    action: 'rts_clear_import_progress',
                    nonce: typeof rts_dashboard_vars !== 'undefined' ? rts_dashboard_vars.nonce : ''
                },
                success: function(response) {
                    if (response.success) {
                        alert('Progress cleared');
                        location.reload();
                    } else {
                        alert('Failed to clear progress');
                    }
                },
                error: function() {
                    alert('Error clearing progress');
                },
                complete: function() {
                    button.prop('disabled', false).text('Clear');
                }
            });
        });

        /**
         * Quick Actions
         */
        $(document).on('click', '[data-action="review-inbox"]', function(e) {
            e.preventDefault();
            window.location.href = 'edit.php?post_type=letter&post_status=pending';
        });
        
        $(document).on('click', '[data-action="view-quarantine"]', function(e) {
            e.preventDefault();
            window.location.href = 'edit.php?post_type=letter&quarantine=1';
        });
        
        $(document).on('click', '[data-action="refresh-status"]', function(e) {
            e.preventDefault();
            location.reload();
        });

        /**
         * Collapsible Sections
         */
        $(document).on('click', '.rts-collapsible-header', function() {
            const header = $(this);
            const content = header.next('.rts-collapsible-content');
            const toggle = header.find('.rts-collapsible-toggle');
            
            content.toggleClass('expanded');
            toggle.toggleClass('expanded');
            
            if (content.hasClass('expanded')) {
                content.css('max-height', content[0].scrollHeight + 'px');
            } else {
                content.css('max-height', '0');
            }
        });
    });

})(jQuery);
